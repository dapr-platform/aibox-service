# AI 盒子服务业务逻辑目录

本目录包含 AI 盒子服务的核心业务逻辑实现，处理设备通信、事件管理和状态监控。

## 文件列表

- **message.go**: 消息处理模块

  - 实现了对 AI 盒子发送的心跳和事件消息的处理逻辑
  - 将收到的心跳消息更新至设备状态
  - 将收到的事件消息保存至事件表

- **device.go**: 设备管理模块
  - 实现设备在线状态监控
  - 定时检查长时间未接收心跳的设备，将其标记为离线
  - 提供设备状态查询接口

## 业务逻辑设计说明

### 消息处理流程

1. 接收并解析来自 AI 盒子的消息
2. 根据消息类型（心跳/事件）分发到不同的处理函数
3. 心跳消息处理:
   - 更新设备最后心跳时间
   - 若设备不存在则自动创建
   - 设置设备状态为在线
4. 事件消息处理:
   - 保存事件信息至数据库
   - 根据事件级别(紧急/严重/轻微/警告)分类处理
   - 设置事件默认状态为活动

### 设备监控机制

1. 启动独立协程，定时检查设备在线状态
2. 对超过设定时间阈值(5 分钟)未收到心跳的设备:
   - 自动将设备状态更新为离线
   - 记录设备离线时间和相关日志
